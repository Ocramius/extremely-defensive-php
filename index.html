<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Extremely Defensive PHP</title>

        <meta name="description" content="Extremely Defensive PHP">
        <meta name="author" content="Marco Pivetta">

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="stylesheet" href="css/theme.css" id="theme">
        <link rel="stylesheet" href="bower_components/reveal.js/lib/css/zenburn.css">

        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match(/print-pdf/gi) ? 'bower_components/reveal.js/css/print/pdf.css'
                : 'bower_components/reveal.js/css/print/paper.css';
            document.getElementsByTagName('head')[0].appendChild(link);
        </script>
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                
                    
                        <section><h1>Hi!</h1></section>

                    
                    
                
                    
                        <section><h1>I'm <span class="doctrine-color">Marco</span>!</h1>
</section>

                    
                    
                
                    
                        <section><h1><a href="https://twitter.com/Ocramius" target="_blank">Ocramius</a></h1>
</section>

                    
                    
                
                    
                        <section><img src="assets/img/ocramius.gif" width="40%" class="crisp-image"/></section>

                    
                    
                
                    
                        <section><blockquote class="twitter-tweet" lang="en">
    <p lang="en" dir="ltr">
        <a href="https://twitter.com/Ocramius">@Ocramius</a>
        <a href="https://twitter.com/asgrim">@asgrim</a>
        <a href="https://twitter.com/RoaveTeam">@RoaveTeam</a>
        Imma start calling you Gandalphp.
    </p>
    &mdash; Lee Davis (@leedavis81)
    <a href="https://twitter.com/leedavis81/status/619104849490264064">9 July 2015</a>
</blockquote>

<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</section>

                    
                    
                
                    
                        <section><img src="assets/img/gandalphp.png" width="40%" class="crisp-image"/>
</section>

                    
                    
                
                    
                        <section><img src="assets/img/roave.svg"/>
</section>

                    
                    
                
                    
                        <section><img src="assets/img/zf-logo.svg"/>
</section>

                    
                    
                
                    
                        <section><img src="assets/img/doctrine.svg"/>
</section>

                    
                    
                
                    
                        <section><h1>
    <span class="zf-color">Extremely</span>
    <span class="doctrine-color">Defensive</span>
    <span class="php-color">PHP</span>
</h1></section>

                    
                    
                
                    
                        <section><p>
    I'm an <span class="zf-color">Extremist</span>.
</p>

<p class="fragment">
    I <span class="php-color">became</span> an <span class="zf-color">Extremist</span>.
</p>

<p class="fragment">
    I
    <span class="php-color">maintain</span>
    <strong>too many</strong>
    <span class="doctrine-color">projects</span>
    that allow
    <strong>too much</strong>.
</p>

<p class="fragment">
    <strong>Everyone</strong>
    wants a shiny
    <span class="zf-color">new feature</span>.
</p>
</section>

                    
                    
                
                    
                        <section data-background="assets/img/feature-creep.jpg" ></section>

                    
                    
                
                    
                        <section><p>
    This talk is about <span class="doctrine-color">aggressive practices</span>.
</p>

<p class="fragment">
    These <span class="doctrine-color">practices</span> work well for <span class="zf-color">long-lived projects</span>.
</p>

<p class="fragment">
    Every <abbr class="doctrine-color" title="Open Source Software">OSS</abbr> project should probably adopt them.
</p>
</section>

                    
                    
                
                    
                        <section><h2>Know your <span class="php-color">Limits</span></h2>

<p class="fragment">
    If you don't like these practices, don't apply them ...
</p>

<p class="fragment">
    ... but please <span class="doctrine-color">be considerate</span> about what you <strong>release</strong>
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    Let's start in a <strong>bold</strong> way
</h2>
</section>

                    
                    
                
                    
                        <section><h2><strong>You</strong> are <span class="php-color">dumb</span></h2>
</section>

                    
                    
                
                    
                        <section><h2>No, I do not mean <strong>You</strong></h2>

<p class="fragment small">(Sorry!)</p></section>

                    
                    
                
                    
                        <section><h2><strong>I</strong> am <span class="php-color">dumb</span></h2>
</section>

                    
                    
                
                    
                        <section><h2><strong>We</strong> are <span class="php-color">dumb</span></h2>
</section>

                    
                    
                
                    
                        <section><h2><strong>Everyone</strong> is <span class="php-color">dumb</span></h2>
</section>

                    
                    
                
                    
                        <section data-background="assets/img/oprah-free-car.gif" ></section>

                    
                    
                
                    
                        <section><p>
    Those who don't admit it, <strong>are</strong> the <span class="php-color">dumbest</span>!
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    Do you know
    <br/>
    <span class="doctrine-color">Defensive Driving</span>?
</h2>

<p class="fragment">
    <span class="doctrine-color">Defensive driving</span>
    <br/>
    =
    <br/>
    assuming that other drivers
    <span class="php-color">will make mistakes</span>
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Defensive coding</span>
    <br/>
    is like
    <br/>
    <span class="zf-color">Defensive Driving</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Be
    <span class="doctrine-color">Cautious</span>
    about
    <br/>
    <span class="zf-color">Everyone's Code</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Be
    <span class="doctrine-color">Cautious</span>
    about
    <br/>
    <span class="zf-color"><strong>Your</strong> Code</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Some <span class="doctrine-color">references</span>
</h2>
</section>

                    
                    
                
                    
                        <section><img src="assets/img/code-complete-2.jpg" alt="Code Complete"/>

<!--
<p class="fragment">
    Although this book is a bit
    <strong>too "easy"</strong>
    on
    <span class="doctrine-color">limits</span>.
</p>
--></section>

                    
                    
                
                    
                        <section><img src="assets/img/effective-java.jpg" alt="Effective Java"/></section>

                    
                    
                
                    
                        <section><h1>
    <span class="zf-color">Poka</span>
    <span class="doctrine-color">Yoke</span>
</h1>

<p class="fragment">
    <span class="zf-color">Avoid</span>
    <span class="doctrine-color">Mistakes</span>
</p>

<p class="fragment">
    <span class="doctrine-color">Fool</span>
    <span class="zf-color">Proofing</span>
</p>
</section>

                    
                    
                
                    
                        <section data-background="assets/img/rj45.jpg" ><h1 class="fragment"><strong class="doctrine-color">Only one way to plug it in</strong></h1>
</section>

                    
                    
                
                    
                        <section data-background="assets/img/usb.jpg" ><h1 class="fragment"><strong class="php-color">Maybe NOT such a good design</strong></h1>
</section>

                    
                    
                
                    
                        <section><h2>
    Let's make
    <br/>
    <strong>one concept</strong>
    <br/>
    clear:
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="zf-color">Code</span>
    is
    <span class="php-color">Reusable</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2><strike>
    <span class="zf-color">Code</span>
    is
    <span class="php-color">Reusable</span>
</strike></h2>

<h2>
    <span class="zf-color">Code</span>
    is
    <strong>NOT</strong>
    <span class="php-color">Reusable</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="zf-color">Code</span>
    is
    <span class="php-color">Crap</span>
</h2>
</section>

                    
                    
                
                    
                        <section><blockquote class="quote" cite="http://en.wikipedia.org/wiki/Sturgeon's_law">
    <p>ninety percent of everything is crap.</p>
    <cite>Theodore Sturgeon</cite>
</blockquote>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Abstractions</span>
    <br/>
    are
    <span class="zf-color">Reusable</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Don't write
    <span class="zf-color">Crap</span>
</h2>

<h2>
    Don't write
    <span class="php-color">Code</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Code for
    <br/>
    <span class="doctrine-color">your Use-case</span>
</h2>

<h2 class="fragment">
    <strong>NOT</strong> for your <br/><span class="php-color">re-use-case</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h1>
    <span class="zf-color">Good</span>
    <span class="doctrine-color">Practices</span>
</h1>
</section>

                    
                    
                
                    
                        <section><h1>
    Assuming
    <abbr title="Single responsibility, Open-closed, Liskov substitution, Interface segregation and Dependency inversion" class="doctrine-color">SOLID</abbr>
    code
</h1>
</section>

                    
                    
                
                    
                        <section><h2>
    Assuming some
    <span class="doctrine-color">Object Calisthenics</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Make
    <span class="php-color">State</span>
    <span class="doctrine-color">Immutable</span>
</h2>

<p class="fragment">
    Greatly reduces
    <span class="php-color">bugs</span>
    and
    <span class="php-color">cognitive load</span>
</p>

<p class="fragment">
    <a href="https://github.com/php-fig/http-message" target="_blank" class="doctrine-color">PSR-7</a>
    got this <strong>right</strong>!
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    What about <span class="zf-color">performance</span>?
</h2>

<p class="fragment">
    Profile!
</p>

<p class="fragment">
    Profile!
</p>

<p class="fragment">
    Profile!
</p>

<p class="fragment">
    <code>> O(log(n))</code>
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>No</strong>
    <span class="php-color">Setters</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="php-color">Setters</span>
    don't mean
    <strong>Anything</strong>, anyway
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    The
    <span class="doctrine-color">Constructor</span>
    is the
    <strong>ONLY</strong>
    <span class="zf-color">injection point</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>No</strong>
    <span class="php-color">un-initialized properties</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="php-color">Optional</span>
    <span class="zf-color">Dependencies</span>?
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class DbConnection
{
    public function __construct(...)
    {
        // ...
    }

    public function setLogger(Logger $logger = null)
    {
        $this->logger = $logger;
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="php-color">Optional dependencies</span>
    <strong>Do Not Exist!</strong>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class DbConnection
{
    public function __construct(..., Logger $logger)
    {
        // ...
    }

    // look ma, no setters!
}
</code></pre>

<pre><code data-trim>
$dbConnection = new DbConnection(..., new FakeLogger());
</code></pre>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>Avoid</strong>
    unnecessary
    <span class="php-color">public methods</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>Unnecessary</strong>
    <br/>
    =
    <br/>
    you can find
    <br/>
    <strong>another way</strong>
</h2>
</section>

                    
                    
                
                    
                        <section><blockquote class="quote">
    A public method is like a child: once you've written it, you are going to maintain it for the rest of its life!
    <cite>Stefan Priebsch</cite>
</blockquote>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>Avoid</strong>
    <span class="php-color">Logic Switch Parameters</span>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class Spammer
{
    public function spam($email, $template, $optOutLink = false)
    {
        // yes, this is a really bad spammer
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class Spammer
{
    public function sendIllegalSpam($email, $template)
    {
        // without opt-out link
    }

    public function sendApparentlyLegalSpam($email, $template)
    {
        // with opt-out link
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><h2>
    All
    <span class="php-color">State</span>
    should be
    <span class="doctrine-color">Encapsulated</span>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class BankAccount
{
    // ...

    public function setLastRefresh(DateTime $lastRefresh)
    {
        $this->lastRefresh = $lastRefresh;
    }
}
</code></pre>

<p class="fragment">(examples are purposely simplified/silly!)</p>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
$currentTime = new DateTime();

$bankAccount1->setLastRefresh($currentTime);
$bankAccount2->setLastRefresh($currentTime);
</code></pre>

<pre class="fragment"><code data-trim>
// ... stuff
</code></pre>

<pre class="fragment"><code data-trim>
$currentTime->setTimestamp($aTimestamp);
</code></pre>

</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class BankAccount
{
    // ...

    public function setLastRefresh(DateTime $lastRefresh)
    {
        $this->lastRefresh = clone $lastRefresh;
    }
}
</code></pre>

<pre><code data-trim>
class BankAccount
{
    // ...

    public function setLastRefresh(DateTimeImmutable $lastRefresh)
    {
        $this->lastRefresh = $lastRefresh;
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class MoneyTransfer
{
    public function __construct(Money $amount, DateTime $transferDate)
    {
        $this->amount       = $amount;
        $this->transferDate = $transferDate;
    }
}
</code></pre>

<pre class="fragment"><code data-trim>
class MoneyTransfer
{
    public function __construct(Money $amount, DateTime $transferDate)
    {
        $this->amount       = $amount;
        $this->transferDate = clone $transferDate;
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="zf-color">External Access</span>
    includes
    <span class="php-color">Subclasses</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Make
    <span class="php-color">State</span>
    <span class="doctrine-color">Private</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Private</span>
    <span class="php-color">properties</span>
</h2>

<p>
    <strong>BY DEFAULT!</strong>
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    A <span class="zf-color">Public Method</span> is a <span class="doctrine-color">Transaction</span>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
public function addMoney(Money $money)
{
    $this->money[] = $money;
}

public function markBillPaidWithMoney(Bill $bill, Money $money)
{
    $this->bills[] = $bill->paid($money);
}
</code></pre>

<pre class="fragment"><code data-trim>
$bankAccount->addMoney($money);
$bankAccount->markBillPaidWithMoney($bill, $money);
</code></pre>

<p class="fragment">
    These methods are part of a
    <span class="doctrine-color">single interaction</span>,
    but are exposed as <span class="php-color">separate public APIs</span>
</p>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
private function addMoney(Money $money)
{
    $this->money[] = $money;
}

private function markBillPaidWithMoney(Bill $bill, Money $money)
{
    $this->bills[] = $bill->paid($money);
}

public function payBill(Bill $bill, Money $money)
{
    $this->addMoney($money);
    $this->markBillPaidWithMoney($bill, $money);
}
</code></pre>

<pre class="fragment"><code data-trim>
$bankAccount->payBill($bill, $money);
</code></pre>

<p class="fragment">
    <span class="doctrine-color">Single public API</span>
    endpoint wrapping around
    <span class="php-color">state change</span>
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>DO NOT</strong> assume <span class="php-color">Method Idempotence</span>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
$userId    = $controller->request()->get('userId');
$userRoles = $controller->request()->get('userRoles');
</code></pre>

<p class="fragment">
    Subsequent method calls are <span class="php-color">assuming</span> that the request will be the <strong>same</strong>
</p>

<p class="fragment"><small>(apart from being <strong>foolish</strong> API)</small></p>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
$request = $controller->request();

$userId    = $request->get('userId');
$userRoles = $request->set('userRoles');
</code></pre>

<p class="fragment">
    No <span class="php-color">assumption</span>
    on what <code>request()</code>
    does: we
    <span class="doctrine-color">don't trust it</span>
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Assert</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Enforce
    <span class="doctrine-color">Strict</span>
    <span class="zf-color">Invariants</span>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class Train
{
    public function __construct(array $wagons)
    {
        $this->wagons = (function (Wagon ...$wagons) {
            return $wagons;
        })(...$wagons);
    }
}
</code></pre>

<p class="fragment">Yes, it's horrible, but it works</p>

<p class="fragment">
    (<a href="http://3v4l.org/GDahs" target="_blank">on PHP 7</a>)
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    <a href="https://github.com/beberlei/assert" target="_blank">beberlei/assert</a>
</h2>

<p class="fragment">
    Just use it!
</p></section>

                    
                    
                
                    
                        <section><h2>
    <strong>No</strong>
    <span class="php-color">Mixed</span>
    <span class="zf-color">Parameter Types</span>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class PrisonerTransferRequest
{
    /**
     * @param mixed $accessLevel
     *                           - false if none
     *                           - true if guards are required
     *                           - null if to be decided
     *                           - 10 if special cargo is needed
     *                           - 20 if high security is needed
     */
    public function approve($securityLevel)
    {
        // ...
    }
}
</code></pre>

<h2 class="fragment">WTFBBQ?!</h2>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class PrisonerTransferRequest
{
    public function approve(PrisonerSecurityLevel $securityLevel)
    {
        // ...
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Value Objects</span>
    <strong>FTW</strong>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Value Objects</span>
    ensure
    <span class="zf-color">Consistency</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Value Objects</span>
    simplify
    <span class="zf-color">Data Validation</span>
</h2>

<pre class="fragment"><code data-trim>
register(new EmailAddress('ocramius@gmail.com'));
</code></pre>

<p class="fragment">
    No need to re-validate inside <code>register()</code>!
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>No</strong>
    <span class="php-color">Mixed</span>
    <span class="zf-color">Return Types</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Value Objects</span>, again!
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>Avoid</strong>
    <span class="php-color">Fluent Interfaces</span>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
$thing
    ->doFoo()
    ->doBar();
</code></pre>

<pre class="fragment"><code data-trim>
$thing = $thing->doFoo();
$thing = $thing->doBar();
</code></pre>

<pre class="fragment"><code data-trim>
$thing->doFoo();
$thing->doBar();
</code></pre>
</section>

                    
                    
                
                    
                        <section><h1>
    <strong class="doctrine-color">POKA</strong>
    <strong class="zf-color">YOKE</strong>
    <strong>!!!!!!!1!!ONE</strong>
</h1>

<p class="fragment">
    Only
    <strong>ONE</strong>
    way!
</p></section>

                    
                    
                
                    
                        <section><pre><code data-trim>
$thing->doFoo();
$thing->doBar();
</code></pre>
</section>

                    
                    
                
                    
                        <section><p>
    (There's a
    <a href="http://ocramius.github.io/blog/fluent-interfaces-are-evil/" target="_blank">blogpost</a>
    for that!)
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    Make
    <span class="php-color">Classes</span>
    <span class="doctrine-color">Final</span>
    <strong>By Default</strong>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    An
    <span class="php-color">Extension</span>
    is a different
    <span class="zf-color">Use-Case</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Does
    <span class="php-color">Extending</span>
    the
    <span class="zf-color">Interface</span>
    <strong>add</strong>
    <span class="doctrine-color">Any Meaning</span>?
</h2>

<div class="fragment">
    <p>If not, then do not use <code>extends</code>.</p>

    <p>You don't even need <code>extends</code>.</p>
</div>
</section>

                    
                    
                
                    
                        <section><p>
    (There's a
    <a href="http://ocramius.github.io/blog/when-to-declare-classes-final/" target="_blank">blogpost</a>
    for that!)
</p>
</section>

                    
                    
                
                    
                        <section><h1>
    <span class="php-color">Traits</span>
</h1>
</section>

                    
                    
                
                    
                        <section><h1>
    <strike><span class="php-color">Traits</span></strike>
</h1>

<p class="fragment">Do you <strong>REALLY</strong> need to re-use that code?</p>
<p class="fragment"><abbr title="Don't repeat yourself">DRY</abbr> or just hidden coupling?</p>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>Ensure</strong>
    <span class="doctrine-color">Deep Cloning</span>
</h2></section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class LoginRequest
{
    public function __clone()
    {
        $this->time = clone $this->time;
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><p>
    <span class="php-color">Cloning</span>
    <strong>requires</strong>
    <span class="zf-color">encapsulated state</span>
    <strong>understanding</strong>
</p>

<p class="fragment">
    ... which is a <strong>contradiction</strong>!
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    So ...
</h2></section>

                    
                    
                
                    
                        <section><h2>
    ... <strong>disable</strong>
    <span class="php-color">Cloning</span>?
</h2></section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class Human
{
    public function __clone()
    {
        throw new \DomainException(
            'Why would you even clone me?!'
            . 'It\'s currently illegal!'
        );
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><h2>Same for <span class="php-color">Serialization</span>!</h2></section>

                    
                    
                
                    
                        <section><h2>
    Is it
    <strong>really</strong>
    <span class="zf-color">Serializable</span>?
</h2>

<p class="fragment">
    Do you know the
    <span class="php-color">lifecycle</span>
    of
    <strong>every</strong>
    <span class="doctrine-color">dependency?</span>
</p>

<p class="fragment">
    Is your
    <span class="php-color">object</span>
    even
    <strong>supposed</strong>
    to be
    <span class="zf-color">stored</span>
    somewhere?
</p>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
class MyAwesomeThing
{
    public function __sleep()
    {
        throw new BadMethodCallException(
            'NO! MY THING! CANNOT HAZ!'
        );
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><h2>
    Maybe
    <span class="php-color">serialize()</span>
    <strong>only</strong>
    if it is a
    <span class="zf-color">Serializable</span>?
</h2></section>

                    
                    
                
                    
                        <section><h1><span class="doctrine-color">UNIT TESTING</span></h1></section>

                    
                    
                
                    
                        <section><h2>
    <span class="zf-color">Test</span>
    <strong>all</strong>
    <span class="doctrine-color">scenarios</span>
</h2>

<p class="fragment">
    <strong>YES, <u>ALL</u> OF THEM!</strong>
</p>

<p class="fragment">
    Bring your
    <abbr title="Change Risk Anti-Patterns" class="doctrine-color">CRAP</abbr>
    score
    <code>&lt;= 2</code>
</p>

<p class="fragment">
    It will make you cry.
</p>

<p class="fragment">
    You will <strong>implore</strong> for less features.
</p>

<p class="fragment">
    You will <strong>love</strong> having less features.
</p>
</section>

                    
                    
                
                    
                        <section><pre><code data-trim>
interface AuthService {
    /**
     * @return bool
     *
     * @throws InvalidArgumentException
     * @throws IncompatibleCredentialsException
     * @throws UnavailableBackendException
     */
    public function authenticate(Credentials $credentials);
}
</code></pre>

<pre class="fragment"><code data-trim>
class MyLogin {
    public function __construct(AuthService $auth) { $this->auth = $auth; }
    public function login($username, $password) {
        if ($this->auth->authenticate(new BasicCredentials($username, $password)) {
            // ...
            return true;
        }
        return false;
    }
}
</code></pre>

<p class="fragment">
    What <strong>can happen</strong> here?
</p>
</section>

                    
                    
                
                    
                        <section><p>
    A <span class="php-color">boolean</span> <code>true</code> is returned
</p>

<p class="fragment">
    A <span class="php-color">boolean</span> <code>false</code> is returned
</p>

<p class="fragment">
    A <code class="php-color">InvalidArgumentException</code> is thrown
</p>

<p class="fragment">
    A <code class="php-color">IncompatibleCredentialsException</code> is thrown
</p>

<p class="fragment">
    A <code class="php-color">UnavailableBackendException</code> is thrown
</p>

<p class="fragment">
    Such little code, <strong>5</strong> tests already!
</p>
</section>

                    
                    
                
                    
                        <section><h1><span class="doctrine-color">Recap</span></h1></section>

                    
                    
                
                    
                        <section><h2>
    These are
    <span class="doctrine-color">suggestions</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Trust</span>
    <strong>NO</strong>
    <span class="zf-color">Code</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Reduce
    <span class="php-color">features</span>
    to the bare <strong>minimum</strong>
</h2>

<h2 class="fragment">
    <abbr title="You Ain't Gonna Need It" class="doctrine-color">YAGNI</abbr>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Strict</span>
    <span class="zf-color">invariants</span>
</h2>

<p class="fragment">
    <span class="doctrine-color">Await</span>
    <span class="zf-color">strict</span>
</p>

<p class="fragment">
    <span class="doctrine-color">Return</span>
    <span class="zf-color">strict</span>
</p>
</section>

                    
                    
                
                    
                        <section><h1><strong>Thanks!</strong></h1>
</section>

                    
                    
                
                    
                        <section><img
    src="/assets/img/rebecca.png"
    alt="https://joind.in/14987"
/>
</section>

                    
                    
                
            </div>
        </div>
        <script src="bower_components/reveal.js/lib/js/head.min.js"></script>
        <script src="bower_components/reveal.js/js/reveal.js"></script>

        <script>
            Reveal.initialize({
                controls:     true,
                progress:     true,
                history:      true,
                center:       true,
                transition:   'none',
                // Optional reveal.js plugins
                dependencies: [
                    {
                        src: 'bower_components/reveal.js/lib/js/classList.js',
                        condition: function() { return !document.body.classList; }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/markdown/marked.js',
                        condition: function() { return !!document.querySelector( '[data-markdown]' ); }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/markdown/markdown.js',
                        condition: function() { return !!document.querySelector( '[data-markdown]' ); }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/highlight/highlight.js',
                        async: true,
                        condition: function() { return !!document.querySelector( 'pre code' ); },
                        callback: function() { hljs.initHighlightingOnLoad(); }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/zoom-js/zoom.js',
                        async: true
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/notes/notes.js',
                        async: true
                    }
                ]
            });
        </script>
    </body>
</html>
